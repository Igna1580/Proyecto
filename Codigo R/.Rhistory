promedios_region$Region == "Norteamerica" ~ "N. Á.",
promedios_region$Region == "Suramerica" ~ "S. Á",
promedios_region$Region == "Medio Oriente, Norte de Africa y Gran Arabia" ~ "M.O./N.Á.",
promedios_region$Region == "Centroamerica y el Caribe" ~ "C.C.",
TRUE ~ promedios_region$Region)  # Mantener otros nombres sin cambios
# - Le quitamos el título pues a la hora de subirlo al overleaf, no queremos que salga el título dos veces
grafico_promedios2 <- ggplot(promedios_region, aes(x = reorder(Region, -Promedio_Felicidad), y = Promedio_Alcohol, fill = Promedio_Felicidad)) +
geom_bar(stat = "identity") +
labs(x = "Región",
y = "Promedio de consumo de alcohol") +
theme_minimal() +
cowplot::theme_cowplot() +
theme(
plot.margin = margin(20, 20, 20, 20),  # Márgenes del gráfico
axis.text.x = element_text(angle = 45, hjust = 1)) +  # Ángulo de 45 grados y alineación a la derecha
scale_fill_gradient(low = "red", high = "green", name = "Índice de felicidad") +
geom_text(aes(label = round(Promedio_Felicidad, 2)), vjust = -0.5) +  # Ajustar el tamaño del texto a 18
coord_cartesian(clip = 'off') +  # Evitar que las barras superiores oculten la leyenda
theme(legend.position = c(0.65, 0.85))  # Posicionar la leyenda en la parte superior y centrada
print(grafico_promedios2)
# - Del gráfico podemos notar que las tres regiones con el índice de felicidad promedio más alto, tambien tienen el consumo de alcohol más alto.
# - Por su parte, las dos regiones con el consumo de alcohol más bajos, también tienen el índice de felcidad promedio más bajo.
# 1b.3 Guardamos el gráfico en un pdf
# ggsave(filename = "grafico_barras2.pdf", plot = grafico_promedios, device = "pdf", width = 10, height = 8)
# 1c. Gráfico 3: Gráfico de dispersión con línea de regresión
# - Nos interesa visualizar el comportamiento de los datos y un grafico de dispersión nos permite relacionar las dos variables de nuestro análisis
# - Cada punto en el gráfico representa un país y su posición en el mismo indica tanto su nivel de consumo promedio como su Índice de felicidad.
# - La línea azul trazada, muestra la tendencia general que existe entre el consumo de alcohol y el Índice de felicidad de todos los países.
# 1c.1 Versión original del gráfico
grafico_dispersion <- ggplot(base_datos, aes(x = poblacion_Total_consumo, y = indice_de_felicidad)) +
geom_point() + cowplot::theme_cowplot() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +  # Línea de regresión
labs(
x = "Consumo de alcohol en litros de alcohol puro",
y = "Índice de felicidad",
title = "Gráfico de dispersión con línea de regresión",
subtitle = "Relación Índice de felicidad y consumo de alcohol") +
theme(
plot.title = element_text(size = 20),
plot.subtitle = element_text(size = 18),# Tamaño del título
axis.title.x = element_text(size = 18),  # Tamaño del título del eje x
axis.title.y = element_text(size = 18),  # Tamaño del título del eje y
axis.text.x = element_text(size = 18),  # Tamaño del texto del eje x
axis.text.y = element_text(size = 18),  # Tamaño del texto del eje y
plot.margin = margin(20, 20, 20, 20))  # Márgenes del gráfico
# - Para guardar el gráfico
# ggsave(filename = "grafico_dispersion.pdf", plot = grafico_dispersion, device = "pdf", width = 4, height = 3)
# 1c.2 Versión para el anteproyecto
grafico_dispersion2 <- ggplot(base_datos, aes(x = poblacion_Total_consumo, y = indice_de_felicidad)) +
geom_point() + cowplot::theme_cowplot() +
geom_smooth(method = "lm", se = FALSE, color = "blue") +  # Línea de regresión
labs(
x = "Consumo de alcohol puro en litros",
y = "Índice de felicidad") +
theme(plot.margin = margin(20, 20, 20, 20))  # Márgenes del gráfico
grafico_dispersion2
# - La línea de regresión presenta una ligera pendiente positiva.
# - Lo anterior indica que de acuerdo con estos datos, existe una relación positiva entre el consumo de alcohol y el Índice de felicidad.
# - En otras palabras, a medida que aumenta el consumo de alcohol, también tiende a aumentar el Índice de felicidad.
# 1c.3 Para guardar el gráfico (sin título para que no se vea dos veces en el anteproyecto)
# ggsave(filename = "grafico_dispersion2.pdf", plot = grafico_dispersion2, device = "pdf", width = 4, height = 3)
# 1d. Gráfico 4: Índice de felicidad promedio por decil de consumo de alcohol
# - El Gráfico 1 no nos evidencia del todo si los países donde se consume más alcohol tienen índices de felicidad más altos.
# - Por esta razón, decidimos dividir a todos los países en deciles según su consumo de alcohol.
# - De esta manera, el decil 1 tiene el 10% de los países con el consumo de alcohol más bajo, mientras que el Decil 10, tiene el 10% de los países con el consumo de alcohol más alto.
# - Ahora, podemos calcular el promedio de índice de felcidad y ver si efectivamente los países donde se consume más alcohol tienden a tener índices de felcidad más altos.
# 1d.1 Primera versión
# - Primero, calculamos los deciles del consumo de alcohol y les asignamos a una nueva variable
base_datos2 <- base_datos2 %>% mutate(decil_alcohol = ntile(poblacion_Total_consumo, 10))
# - Segundo, calculamos el promedio, máximo y mínimo del índice de felicidad para cada decil
promedio_felicidad_por_decil <- base_datos2 %>% group_by(decil_alcohol) %>% summarize(promedio_felicidad = mean(indice_de_felicidad))
max_felicidad_por_decil <- base_datos2 %>% group_by(decil_alcohol) %>% summarize(max_felicidad = max(indice_de_felicidad))
min_felicidad_por_decil <- base_datos2 %>% group_by(decil_alcohol) %>% summarize(min_felicidad = min(indice_de_felicidad))
# - Tercero creamos un gráfico de línea que representa el índice de felicidad promedio para cada decil de consumo de alcohol.
# - Además, en el gráfico, agregamos los máximos y mínimos de cada decil
gráfico_Línea <- ggplot(promedio_felicidad_por_decil, aes(x = decil_alcohol, y = promedio_felicidad)) +
geom_line() +
geom_point(data = max_felicidad_por_decil, aes(x = decil_alcohol, y = max_felicidad), color = "green", size = 3, shape = 24) +
geom_point(data = min_felicidad_por_decil, aes(x = decil_alcohol, y = min_felicidad), color = "red", size = 3, shape = 25) +
labs(
x = "Decil",
y = "Índice de felicidad promedio",
title = "Índice de felicidad promedio según decil de consumo de alcohol"
) +
theme_minimal() +
cowplot::theme_cowplot() +
scale_x_continuous(breaks = 0:10) +
theme(
plot.title = element_text(size = 20),
axis.title.x = element_text(size = 18),
axis.title.y = element_text(size = 18),
axis.text.x = element_text(size = 18),
axis.text.y = element_text(size = 18),
plot.margin = margin(20, 20, 20, 20)
) +
geom_vline(xintercept = 1:10, linetype = "dashed", color = "gray", linewidth = 0.5) +
geom_hline(yintercept = seq(4, 8, 1), linetype = "dashed", color = "gray", linewidth = 0.5)
# 1d.2 Versión para el anteproyecto (sin título)
grafico_Linea2 <- ggplot(promedio_felicidad_por_decil, aes(x = decil_alcohol, y = promedio_felicidad)) +
geom_line() +
geom_point(data = max_felicidad_por_decil, aes(x = decil_alcohol, y = max_felicidad), color = "green", size = 3, shape = 24) +
geom_point(data = min_felicidad_por_decil, aes(x = decil_alcohol, y = min_felicidad), color = "red", size = 3, shape = 25) +
labs(
x = "Decil",
y = "Índice de felicidad") +
theme_minimal() +
cowplot::theme_cowplot() +
scale_x_continuous(breaks = 0:10) +
scale_y_continuous(breaks = 0:8) +
theme(plot.margin = margin(20, 20, 20, 20)) +
geom_vline(xintercept = 1:10, linetype = "dashed", color = "gray", linewidth = 0.5) +
geom_hline(yintercept = seq(4, 8, 1), linetype = "dashed", color = "gray", linewidth= 0.5)
print(grafico_Linea2)
# - Del gráfico anterior, se puede observar que a medida que se consideran deciles más altos,
#   es decir, deciles donde el consumo de alcohol es mayor, el Índice de felicidad aumenta
#   gradualmente hasta llegar al decil 8, donde se alcanza el Índice de felicidad promedio más alto.
# 2. Realizamos cuadrados de análisis descriptivo
# En esta sección se presentan los gráficos que hicimos para fundamentar el análisis descriptivo
# 2a. Cuadro 1: Calcular el índice de felicidad promedio, varianza, máximo y mínimo, y obtener los nombres de los países para cada región
# - Nos interesa calcular ciertos estadísticos para conocer como se comporta el índice de felidad y el consumo de alcohol para cada región.
# - Además agregamos una columna para conocer el # de países que tenemos para cada región, pues esto puede influir en nuestra interpretación de los datos.
# - Este cuadro nos va a ser útil para complementar la información del gráfico 2.
resumen_felicidad_por_region <- base_datos2 %>%
group_by(Region) %>%
summarize(
Cantidad_Paises = n(),
Promedio_Consumo_Alcohol = round(mean(poblacion_Total_consumo), 2),
Promedio_Índice_de_felicidad = round(mean(indice_de_felicidad), 2),
Varianza_Índice_de_felicidad = round(var(indice_de_felicidad), 2),
Máximo_Índice_de_felicidad = round(max(indice_de_felicidad), 2),
Mínimo_Índice_de_felicidad = round(min(indice_de_felicidad), 2))
print(resumen_felicidad_por_region)
# 2a.1 Resultados importantes:
# -- Vemos que la región Australia y Oceanía, así como también Norteamérica, tienen pocos países (2 y 3 reespectivamente).
# -- También vemos que tenemos 40 países en la región de Europa.
# -- Vemos que la varianza más alta en relación al índice de felicidad la tiene la región de Medio Oriente, Norte de Africa y Gran Arabia. Esto tiene sentido cuando analizamos que el I.F. máximo es de 7.47, pero el promedio está en 1.21.
# -- Si comparamos las regiones de Centroamérica y el Caribe con Suramérica que tienen cantidad de países similares, en Suramérica tienen un promedio de cosnumo de alcohol más alto, pero tienen un promedio de I.F. más bajo.
# -- Si analizamos por regiones, vemos que las regiones de Africa Sub-sahariana, Asia, Centroamerica y el Caribe, Medio Oriente, Norte de Africa y Gran Arabia, tienen un consumo promedio de alcohol en litros de alcohol puro menor al promedio muestral de 6.23.
# -- Por su parte, las regiones de Africa Sub-sahariana, Asia, Medio Oriente, Norte de Africa y Gran Arabia tienen un índice de felicidad promedio menor al promedio muestral de 5.54.
# 2a.2 Crear la tabla LaTeX
# tabla_latex2 <- xtable(resumen_felicidad_por_region, caption = "Resumen Estadístico del Índice de Felicidad por Región",label = "tab:resumen-felicidad-region")
# 2a.3 Configurar opciones para ajustar la tabla a una sola página
# options(xtable.comment = FALSE)
# print(tabla_latex2, file = "tabla_region.tex", floating = FALSE, hline.after = c(-1, 0, nrow(resumen_felicidad_por_region)))
# 2b. Cuadro 2: Consumo promedio de alcohol para cada decil
# - Va ser importante poder presentar cual es el consumo promedio de alcohol de cada decil
# 2b.1 Calcular el consumo promedio de alcohol para cada decil
consumo_promedio_por_decil <- base_datos2 %>%
group_by(decil_alcohol) %>%
summarize(Consumo_Promedio_Alcohol = round(mean(poblacion_Total_consumo),2))
print(consumo_promedio_por_decil)
# 2b.2 Resultados interesantes:
# -- Si se considera una cerveza con un promedio de 12 onzas (aproximadamente 0,355 litros) y un contenido promedio de alcohol puro del 5%, esto equivale a aproximadamente 0,0178 litros de alcohol puro por cerveza.
# -- Si en el decil 1, se consume un promedio de 0.33 litros de alcohol puro por persona al año, eso significa que la persona promedio en este decil consume alrededor de 18.5 cervezas al año.
# -- Contrario en el decil 10, si el consumo promedio es de 12.6 litros de alcohol puro por persona al año, esto significa que la persona promedio en este decil consume alrededor de 707.865 cervezas al año.
# -- Ahora, una persona en el decil 5, cuyo consumo promedio es de 5.28, consume alrededor de 296 cervezas al año.
# -- Es importante resaltar que todos esos cálculos se basaron en promedios y en la suposición de que las personas solo consumen cerveza, lo que no refleja la realidad de la mayoría de las personas.
# 2b.3 Crear la tabla LaTeX
# tabla_latex1 <- xtable( resumen_felicidad_por_decil, caption = "Resumen Estadístico del Índice de Felicidad por Decil de Consumo de Alcohol",label = "tab:resumen-felicidad-decil")
# 2b.4 Configurar opciones para ajustar la tabla a una sola página
# options(xtable.comment = FALSE)
# print(tabla_latex1, file = "tabla_deciles.tex", floating = FALSE, hline.after = c(-1, 0, nrow(promedio_felicidad_por_decil)))
# 2c. Cuadro 3: índice de felicidad promedio, varianza, máximo y mínimo para cada decil
# - Nos parece importante tener un cuadro donde podamos ver algunos estadísticos para cada decil que consideramos relevante para nuestra investigación.
# - Este nos permite complementar con el gráfico 4
# 2c.1 Calcular el índice de felicidad promedio, varianza, máximo y mínimo, y obtener los nombres de los países para cada decil
resumen_felicidad_por_decil <- base_datos2 %>%
group_by(decil_alcohol) %>%
summarize(
Promedio = round(mean(indice_de_felicidad),2),
Varianza = round(var(indice_de_felicidad),2),
Máximo = round(max(indice_de_felicidad),2),
Mínimo = round(min(indice_de_felicidad),2))
print(resumen_felicidad_por_decil)
# 2c.2 Resultados interesantes
# -- Vemos que en general, deciles de mayor consumo tienden a reportar niveles de felicidad promedio más altos en comparación con aquellos en los deciles de menor consumo
# -- También, vemos que la varianza cambia mucho para cada decil, alcanzando una varianza de 1.67 en el decil 4 y una de 0.54 en el decil 3.
# -- Notamos que los deciles 1 y 2 muestran los promedios de índice de felicidad más bajos mientras que los deciles 10, 9 y 8 el índice de felicidad promedio más alto.
# -- El país más feliz, está en el decil 8 (Finlandia)
# -- El país menos feliz, está en el decil 1 (Afganistán)
# 3. Objetivos específicos
# 3a. Objetivo: Encontrar el coeficiente de correlación de Spearman entre el consumo de alcohol y la percepción de felicidad.
# - Es importante resaltar, que como nuestros datos de alcohol no siguen una distribución normal, no podemos aplicar la correlación de Spearman
# - Por ese motivo, recurrimos a calcular la correlación utilizando el método de Spearman
# - Correlación de Spearman: un método no paramétrico que no requiere suposiciones sobre la distribución de los datos de la muestra.
#   La correlación de Spearman se utiliza para analizar la asociación entre dos variables cuantitativas, midiendo la fuerza y la dirección de la relación entre ellas.
#   Esta asociación puede ser lineal o curvilínea, positiva o negativa, y el coeficiente de correlación toma valores entre -1 y 1, donde -1 representa una relación negativa, 1 una relación positiva y 0 una falta de correlación.
# 3a.1 Cuadro 4: Matriz de correlación entre consumo de alcohol y variables de el índice de felicidad
# - Queremos calcular la correlación entre el consumo de alcohol y todas las variables que aparecen en el reporte del índice de felicidad
# - Esto nos permitirá conocer si hay variables que tienen una correlación más significativa entre ellas.
# 3a.1.1 Variables de ínterés para el cálculo de la correlación
variables_interes <- c("poblacion_Total_consumo", "indice_de_felicidad", "apoyo_social", "esperanza_de_vida_saludable", "libertad_para_toma_de_decisiones", "generosidad", "percepcion_de_corrupcion")
# 3a.1.2 Calcular la matriz de correlación de Spearman
correlacion_spearman <- round(cor(base_datos[variables_interes], method = "spearman"), 2)
print(correlacion_spearman)
# 3a.1.3 Resultados interesantes
# -- La correlación de Spearman entre el consumo de alcohol y el índice de felicidad según los datos obtenidos es de 0.55.
# -- Ese coeficiente de correlación, según Barrera (2014), se clasifica como una correlación positiva considerable.
# -- Esperanza de vida saludable y percepción a la corrupción muestran tener la correlación negativa más alta con -0.4.
# -- Apoyo social y el índice de felicidad muestran tener la correlación positiva más alta con 0.85.
# 3a.1.4 Guardamos la correlación de spearman entre el consumo de alcohol y todas las variables del indice de felicidad
correlacion_spearman_consumoYvariables <- data.frame(correlacion_spearman = correlacion_spearman[, 1])
# 3a.1.5 Resultados importantes para la presente investigación
# -- La correlación más alta entre el consumo de alcohol y las variables del WHR, es la de apoyo social.
# -- La segunda correlación más alta entre consumo de alcohol y las variables es el índice de felicidad.
# -- Sabiendo que la correlación más alta de la matriz de correlación fue la de apoyo social con índice de felicidad, parece que estas tres variables están relacionadas.
# -- Parece una correlación muy débil y negativa entre el consumo de alcohol y las variables de generosidad y percepción de corrupción
# -- Va ser interesante evaluar la correlción entre consumo de alcohol y apoyo social.
# 3a.2 Cuadro 5: Correlación entre consumo de alcohol y variables de el índice de felicidad para cada región
# - Queremos ver si dividiendo los países por regiones, encontramos alguna correlación interesante entre el consumo de alcohol y las variables del WHR
# 3a.2.1 Regiones de interés
regiones_unicas <- c("Europa", "Africa Sub-sahariana", "Asia", "Australia y Oceania", "Norteamerica", "Suramerica", "Centroamerica y el Caribe", "Medio Oriente, Norte de Africa y Gran Arabia")
# 3a.2.2 Calcular la correlación de Spearman para cada región
correlaciones_Regiones <- data.frame(Variable = variables_interes)
for (region in regiones_unicas) {
subset_data <- base_datos[base_datos$Region == region, variables_interes]
correlaciones <- sapply(variables_interes, function(variable) cor(subset_data$poblacion_Total_consumo, subset_data[[variable]], method = "spearman"))
correlaciones_Regiones[region] <- correlaciones}
# 3a.2.3 Convertir las correlaciones a tipo numérico
correlaciones_Regiones[, -1] <- lapply(correlaciones_Regiones[, -1], as.numeric)
# 3a.2.4 Redondear los datos a dos decimales
correlaciones_Regiones[, -1] <- round(correlaciones_Regiones[, -1], 2)
print(correlaciones_Regiones)
# 3a.2.5 Resultados interesantes
# -- Europa: La correlación más significativa entre consumo de alcohol de la población total y las variables del WHR es negativa y es generosidad con una correlación débil de -0.30.
#           Es decir, parece ser a medida que aumenta el consumo de alcohol, la generosidad en esta región es menor.
# -- Africa Sub-sahariana: En esta región, la correlación más significativa entre el consumo de alcohol y las variables es la de apoyo social. La relación es positiva y de 0.43.
#                         Entonces en esta región, en cierto grado, a medida que aumenta el consumo de alcohol, aumenta también el apoyo social.
# -- Asia: En este país, las correlaciones entre consumo de alcoholy las variables del WHR están débiles, siendo la más significativa la de generosidad con -0.29.
# -- Australia y Oceanía: En esta región, sólo están dos países, sin embargo podemos decir que los dos países muestran el mismo comportamiento entre consumo de alcohol y las demás variables.
#                        En particular, las variables con correlación positiva son el de índice de felicidad y apoyo social.
# -- Norteamérica: En esta región, las variables de apoyo social, índice de felicidad, esperanza de vida saludable y generosidad tienen una correlación positiva de 0.5.
# -- Suramérica: En esta región, la correlación más significativa entre consumo de alcohol y las variables es el índice de felicidad con 0.73, seguida por apoyo social con 0.58.
# -- Centroamérica y el Caribe: En esta región, la relación más significativa entre consumo de alcohol y las demás variables es generosidad con -0.57.
#                              Por su parte, la segunda relación más significativa es la de apoyo social con 0.52.
# -- Medio Oriente, Norte de Africa y Gran Arabia: Para esta región, la correlación más significativa se da para la variable de esperanza de vida saldable con 0.77.
# - Entonces vemos como si analizamos por regiones, se evidencian diferentes correlaciones significativas.
# - Importante señalar que para ciertas regiones, se da una correlación negativa débil entre consumo de alcohol y generosidad.
# 3a.3 Cuadro 6: Correlación entre consumo de alcohol y variables de índice de felicidad para cada decil
# - También queremos ver la correlación entre consumo de alcohol y las demás variables del wHR, para ver si hay patrones diferentes si consideramos diferentes niveles de consumo de alcohol.
# 3a.3.1 Calcular las correlaciones para cada decil
correlaciones_Deciles <- data.frame(Variable = variables_interes)
deciles <- unique(base_datos2$decil_alcohol)
for (decil in deciles) {
subset_data <- base_datos2[base_datos2$decil_alcohol == decil, variables_interes]
correlaciones <- sapply(variables_interes, function(variable) {
cor(subset_data$poblacion_Total_consumo, subset_data[[variable]], method = "spearman")
})
correlaciones_Deciles[, as.character(decil)] <- correlaciones
}
print(correlaciones_Deciles)
# 3a.3.2 Resultados interesantes
# -- Deciles 1, 2, 4: Para estos deciles, la correlación más significativa entre consumo de alcohol y las variables del WHR es Percepción a la corrupción.
#                     Para decil 1 es de 0.277,  para decil 2 es de 0.505, para decil 3 es de -0.53.
#                     Note que en el caso de decil 1 y 2. lo que podemos interpretar es que a medida que se consideran consumo de alcohol más altos, la percepción de corrupción de los habitantes de estos países, también aumenta.
# -- Decil 3: En el caso de este decil, la correlación más signficativa es negativa, por -0.52747253 y correspondiente a la variable de esperanza de vida saludable.
#             Es decir, a medida de que aumenta el consumo de alcohol para este decil, la esperanza de vida saludable disminuye.
# -- Decil 5: En este caso, la correlación más significativa corresponde al índice de felicidad y es de -0.3351648.
# -- Decil 6 y 7: Contrario a lo visto en el decil 5, la correlación más significativa para estos dos deciles también corresponde al índice de felicidad pero esta vez positiva, de 0.73 y 0.65 respectivamente.
# -- Decil 8: Este decil que es el que vimos que tenía el índice de felicidad más alto, tiene la correlación más significativa de percepción a la corrupción y es negativa -0.49586965.
# -- Decil 9: La variable con la correlación más significativa es apoyo social y es de -0.40165100. Entonces a medida de que aumenta el consumo de alcohol, disminuye el apoyo social.
# -- Decil 10: Este decil que es el que consume más alcohol, muestra una no correlación para el índice de felcidad y percepción de la corrupción.
# - Vemos entonces que todos los deciles tienen comportamientos diferentes en relación a la correlación entre consumo de alcohol y las variables del WHR.
# - Los resultados del decil 8 son consistentes a lo que habíamos analizado pues este siendo el que vimos que tenia el índice de felcidad promedio más alto, también muestra que a medida de que aumenta el consumo de alcohol, parece ser que los habitantes consideran su país menos corrupto.
# 3b. Construir la función de distribución del coeficiente de correlación.
# - Queremos contruir la distribución del coeficiente de correlación de Spearman, lo cual lo haremos utilizando el método de Bootstrap.
# - Para ello, utilizamos la función boot, la cual considera la muestra original como la verdadera.
# - Nuestra muestra original tiene 131 datos, para los cuales tenemos datos de consumo de alcohol y el índice de felicidad, entonces la función lo que hace es agarrar 131 pares de datos aleatoriamente de la muestra original, los pares pueden repetirse y hace una muestra nueva de 131 datos.
# - A esa muestra nueva, le calcula el coeficiente de correlación de spearman, y lo almacena en un vector.
# - Este proceso lo repite 1000 veces y al final utilizamos ese vector para observar a la distribución del coeficiente de correlación.
set.seed(123) # para que toda las veces que lo corramos obtengamos el mismo boot
bootstrap_distribución_coeficiente <- boot(base_datos[c("poblacion_Total_consumo","indice_de_felicidad")], statistic = function(data, i) {
cor(data[i, "poblacion_Total_consumo"], data[i, "indice_de_felicidad"], method='spearman')}, R = 1000)
# 3b.1 Para visualizar los 1000 coeficientes de correlación
bootstrap_distribución_coeficiente$t
# 3b.2 Creamos un histograma de las muestras bootstrap
dist.coef.correlacion.spear <-   hist(bootstrap_distribución_coeficiente$t, main = "Distribución Bootstrap del coeficiente de correlación de Spearman",
xlab = "Coeficiente de correlación de spearman", col = "lightblue")
# 3b.3 Realizamos pruebas de hipotesis de normalidad
# - Nos interesa saber si nuestra distribución del coeficiente de correlación sigue una distribución normal
# - Hipotesis nula (H0): Los datos de la distribución del coeficiente de correlación de Spearman por metodo bootstrap siguen una distribución normal
# - Hipotesis alternativa (H1): Los datos de la distribución del coeficiente de correlación de Spearman por metodo bootstrap NO siguen una distribución normal
# 3b.3.1 Prueba de Kolmogrov-Smirnov
ks_test_coeficiente <- ks.test(
bootstrap_distribución_coeficiente$t,  # Los datos que se están probando
"pnorm",                        # La distribución teórica con la cual estamos comparando que en este caso, una distribución normal estándar
mean = mean(bootstrap_distribución_coeficiente$t),  # La media  de los datos de la correlación
sd = sd(bootstrap_distribución_coeficiente$t))
# - Resultados
# -- p-value = 0.7079
# -- D = 0.022199
# -- alternative hypothesis: two-sided
# -- p > 0.05 => No tenemos suficiente evidencia para rechazar la hipotesis nula, es decir , los resultados de la prueba de Kolmogrov-Smirnov no sugieren que los datos del coeficiente de correlación de spearman sean significativamente diferentes de una distribución normal.
# 3b.3.2 Prueba de Anderson-Darling
ad_test_coeficiente <- ad.test(bootstrap_distribución_coeficiente$t)
# - Resultados
# -- p-value = 0.1579
# -- A = 0.54828
# -- p > 0.05 => No tenemos suficiente evidencia para rechazar la hipotesis nula, es decir , los resultados de la prueba de Anderson Darling no sugieren que los datos del coeficiente de correlación de spearman sean significativamente diferentes de una distribución normal.
# 3b.3.3 Prueba de Lilliefors
lil_test_felicidad <- lillie.test(bootstrap_distribución_coeficiente$t)
# -- p-value = 0.2714
# -- D = 0.022199
# -- p > 0.05 => No tenemos suficiente evidencia para rechazar la hipotesis nula, es decir , los resultados de la prueba de Lilliefors no sugieren que los datos del coeficiente de correlación de spearman sean significativamente diferentes de una distribución normal.
# 3b.4 Conclusión general
# - No tenemos suficiente evidencia para rechazar la hipotesis nula.
# 3b.5 Calcular los estadísticos relevantes de la distribución del coeficiente de correlación de Spearman
minimo_dist <- round(min(bootstrap_distribución_coeficiente$t),2)
maximo_dist <- round(max(bootstrap_distribución_coeficiente$t),2)
rango_dist <- round(maximo_dist - minimo_dist,2)
media_dist <- round(mean(bootstrap_distribución_coeficiente$t),2)
mediana_dist <- round(median(bootstrap_distribución_coeficiente$t),2)
primer_cuartil_dist <- round(quantile(bootstrap_distribución_coeficiente$t, 0.25),2)
tercer_cuartil_dist <- round(quantile(bootstrap_distribución_coeficiente$t, 0.75),2)
rango_intercuartil_dist <- round(tercer_cuartil_dist - primer_cuartil_dist,2)
desviacion_estandar_dist <- round(sd(bootstrap_distribución_coeficiente$t),2)
varianza_dist <- round(var(bootstrap_distribución_coeficiente$t),2)
coeficiente_variacion_dist <- round(desviacion_estandar_dist / media_dist,2)
# 3b.5.1 Creamos un data frame con los resultados
resultados_estadisticos_dist <- data.frame(
Mínimo = minimo_dist,
Máximo = maximo_dist,
Rango = rango_dist,
Media = media_dist,
Mediana = mediana_dist,
PrimerCuartil = primer_cuartil_dist,
TercerCuartil = tercer_cuartil_dist,
RangoIntercuartil = rango_intercuartil_dist,
DesviacionEstandar = desviacion_estandar_dist,
Varianza = varianza_dist,
CoeficienteVariacion = coeficiente_variacion_dist
)
rownames(resultados_estadisticos_dist) <- "Distribución del coeficiente de correlación de Spearman"
print(resultados_estadisticos_dist)
# 3b.2 Resultados interesantes:
# -- La media de la distribución del coeficiente de correlación de Spearman entre el índice de felicidad y el consumo de alcohol es de 0.55.
# -- Originalmente, el coeficiente de correlación de spearman nos había dado exactamente igual, 0.55.
# -- El valor mínimo es de 0.34 y el máximo es 0.75.
# -- La varianza es cercana a 0.
# 3b. Objetivo: Determinar intervalos de confianza para la distribución del coeficiente de correlación.
# - Para cumplir con este objetivo específico, vamos a utilizar dos métodos para encontrar los intervalos de confianza
# 3b.1 Intervalos de confianza para el método bootstrap
# - Calcular los intervalos de confianza nos permite determinar que tan acertados son los resultados obtenidos.
# 3b.1.1 Calculamos la desviación estándar de los coeficientes de correlación de Spearman
sd_boot_spearman <- sd(bootstrap_distribución_coeficiente$t)
# 3b.1.2 Almacenamos la correlación entre consumo de alcohol y el índice de felicidad
r <- cor(base_datos2$poblacion_Total_consumo, base_datos2$indice_de_felicidad, method = "spearman")
# 3b.1.3 Para un nivel de confianza del 95%, buscamos el valor que deja un 2.5% de probabilidad en la cola derecha de una distribución normal est.
z <- qnorm(0.975)
# 3b.1.3 Calculamos los intervalos de confianza para el método de bootstrap
lower_bootstrap <- r - z * sd_boot_spearman
# -- Intervalo de confianza inferior = 0.4260598
upper_bootstrap <- r + z * sd_boot_spearman
# -- Intervalo de confianza superior = 0.6785526
# -- Interpretación: El intervalo [0.4260598, 0.6785526] contiente el coeficiente
#    de correlación de spearman entre el consumo de alcohol y el índice de feli-
#    cidad con un nivel de confianza del 95%.
# 3b.1.4 Queremos visualizar la densidad de la distribución del coeficiente de correlación bajo el método bootstrap con los intervalos de confianza
plot_densidad <- density(bootstrap_distribución_coeficiente$t)
# - Para guardarlo, abre el dispositivo de salida PDF
# pdf("grafico_distribucion_spearman.pdf", width = 8, height = 6)
plot(plot_densidad, main = "",
xlab = "Coeficiente de Correlación de Spearman", ylab = "Densidad", col = "blue") +
polygon(c(lower_bootstrap, plot_densidad$x, upper_bootstrap),
c(0, plot_densidad$y, 0), col = "lightblue") +
abline(v = c(lower_bootstrap, upper_bootstrap), col = "red", lwd = 2, lty = 2) +
abline(v = media_dist, col = "black", lwd = 1) +
text(lower_bootstrap, 0.005, "Límite Inferior = 0.43", srt = 90, adj = c(-0.5, -0.5)) +
text(upper_bootstrap, 0.005, "Límite Superior = 0.69", srt = 90, adj = c(-0.5, -0.5)) +
text(media_dist, 0.005, "Media = 0.55", srt = 90, adj = c(-0.3, -0.5), col = "black") +
cowplot::theme_cowplot()
# Cierra el dispositivo de salida PDF
# dev.off()
# 3b.2 Intervalos de confianza método delta, ajustado a spearman
# - Como nuestros datos de consumo de alcohol no son normales, no podemos utilizar el método delta para calcular los intervalos de confianza.
# - Sin embargo, utilizando lo establecido por Bonnett (2000), le podemos hacer una modificación a este método para calcular los intervalos de confianza utilizando la correlación de spearman.
# 3b.2.1 Función inversa de la tangente hiperbólica de la correlación entre consumo de alcohol y el índice de felicidad
# - trabajamos inicialmente en la escala arctan
d <- atanh(r)
# 3b.2.2 Varianza ajustada de los coeficientes de correlación de Spearman
var_d <- (1+(r^2)/2)/(nrow(base_datos)-3)
# 3b.2.3 Intervalos de confianza inferior y superior, regresamos a la escala original
lower_delta <- tanh(d - z*sqrt(var_d))
# -- lower_delta = 0.4100848
upper_delta <- tanh(d + z*sqrt(var_d))
# -- upper_delta <- 0.6683053
# 3b.2.3 Interpretación
# -- Utilizando el método delta ajustado para el coeficiente de correlación de spearman,
#    decimos que con una confianza del 95%, el coeficiente de correlación de spearman,
#    está en el intervalo [0.4100848, 0.6683053]
# 3c.Diferencias entre los intervalos de confianza
dif_inferior <- abs(lower_bootstrap-lower_delta)
# dif_inferor <- 0.01597501
dif_superior <- abs(upper_bootstrap-upper_delta)
# dif_superior <- 0.0102473
# 3c.1 Interpretación:
# -- Vemos que utilizando ambos métodos para calcular los intervalos de confianza,
#    los resultados fueron muy similares, con diferencias cerca de 0.01 para cada intervalo.
# -- Entonces, con una confianza del 95%, podemos decir que el coeficiente de correlación de Spearman
#    entre consumo de alcohol y el índice de felicidad está en el intervalo [0.43,0.69]
# -- En relación a nuestro proyecto de investigación, entonces lo que estamos observando es que sí existe
#    una correlación positiva entre el consumo de alcohol y el índice de felicidad en países alrededor del mundo.
# -- Estamos viendo que esa correlación, según la clasificación de Barrera (2014), se considera positiva media ó considerable.
# 4. Prueba de hipotesis
# Definir una función para dividir las correlaciones en S0 y S1
dividir_correlaciones <- function(correlaciones, umbral = 0.5, nivel_significancia = 0.05) {
S0 <- vector("list", length(correlaciones))
S1 <- vector("list", length(correlaciones))
for (i in 1:length(correlaciones)) {
p_valor <- cor.test(x = base_datos$poblacion_Total_consumo, y = base_datos$indice_de_felicidad, method = "spearman", exact = FALSE, conf.level = 0.95, conf.int = TRUE,
alternative = "two.sided")$p.value
if (p_valor >= nivel_significancia) {
S0[[i]] <- correlaciones[i]
} else {
S1[[i]] <- correlaciones[i]
}
}
S0 <- unlist(S0, use.names = FALSE)
S1 <- unlist(S1, use.names = FALSE)
return(list(S0 = S0, S1 = S1))
}
resultados <- dividir_correlaciones(bootstrap_distribucion_coeficiente$t, umbral = 0.5, nivel_significancia = 0.05)
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, umbral = 0.5, nivel_significancia = 0.05)
resultados
# Definir una función para dividir las correlaciones en S0 y S1
dividir_correlaciones <- function(correlaciones, umbral = 0.5) {
S0 <- vector("list", length(correlaciones))
S1 <- vector("list", length(correlaciones))
for (i in 1:length(correlaciones)) {
if (correlaciones[i] >= umbral) {
S0[[i]] <- correlaciones[i]
} else {
S1[[i]] <- correlaciones[i]
}
}
S0 <- unlist(S0, use.names = FALSE)
S1 <- unlist(S1, use.names = FALSE)
return(list(S0 = S0, S1 = S1))
}
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, umbral = 0.5, nivel_significancia = 0.05)
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, umbral = 0.5)
resultados
length(resultados$S0)
length(resultados$S1)
x_bar_1 <- mean(bootstrap_distribución_coeficiente$t)
s_1 <- sd(bootstrap_distribución_coeficiente$t)
n <- length(bootstrap_distribución_coeficiente$t)
(u_1 <- sqrt(n) * (x_bar_1 - 4) / s_1)
x_bar_1 <- mean(bootstrap_distribución_coeficiente$t)
s_1 <- sd(bootstrap_distribución_coeficiente$t)
n <- length(bootstrap_distribución_coeficiente$t)
(u_1 <- sqrt(n) * (x_bar_1 - 0.5) / s_1)
x_bar_1
# Definir una función para dividir las correlaciones en S0 y S1
dividir_correlaciones <- function(correlaciones, correlacion0 = 0.5, c = 0.05) {
S0 <- vector("list", length(correlaciones))
S1 <- vector("list", length(correlaciones))
for (i in 1:length(correlaciones)) {
if (abs(correlaciones[i] - correlacion0) <= c) {
S0[[i]] <- correlaciones[i]
} else {
S1[[i]] <- correlaciones[i]
}
}
S0 <- unlist(S0, use.names = FALSE)
S1 <- unlist(S1, use.names = FALSE)
return(list(S0 = S0, S1 = S1))
}
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, umbral = 0.5)
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, correlacion0 = 0.5, c = 0.05)
resultados
# Definir una función para dividir las correlaciones en S0 y S1
dividir_correlaciones <- function(correlaciones, correlacion_media = mean(bootstrap_distribución_coeficiente$t), c = 0.05) {
S0 <- vector("list", length(correlaciones))
S1 <- vector("list", length(correlaciones))
for (i in 1:length(correlaciones)) {
if (abs(correlaciones[i] - correlacion0) <= c) {
S0[[i]] <- correlaciones[i]
} else {
S1[[i]] <- correlaciones[i]
}
}
S0 <- unlist(S0, use.names = FALSE)
S1 <- unlist(S1, use.names = FALSE)
return(list(S0 = S0, S1 = S1))
}
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, correlacion_media, c = 0.05)
# Definir una función para dividir las correlaciones en S0 y S1
dividir_correlaciones <- function(correlaciones, correlacion_media = mean(bootstrap_distribución_coeficiente$t), c = 0.05) {
S0 <- vector("list", length(correlaciones))
S1 <- vector("list", length(correlaciones))
for (i in 1:length(correlaciones)) {
if (abs(correlaciones[i] - correlacion_media) <= c) {
S0[[i]] <- correlaciones[i]
} else {
S1[[i]] <- correlaciones[i]
}
}
S0 <- unlist(S0, use.names = FALSE)
S1 <- unlist(S1, use.names = FALSE)
return(list(S0 = S0, S1 = S1))
}
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t, correlacion_media, c = 0.05)
resultados <- dividir_correlaciones(bootstrap_distribución_coeficiente$t,mean(bootstrap_distribución_coeficiente$t), c = 0.05)
resultados
length(S0)
length(resultados$S0)
length(resultados$S1)
probabilidad_S1 <- length(resultados$S1) / length(bootstrap_distribución_coeficiente$t)
probabilidad_S1
probabilidad_S0 <- length(resultados$S0) / length(bootstrap_distribución_coeficiente$t)
probabilidad_S0
